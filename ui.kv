#:kivy 2.3.0

<Label>:
    font_name: app.font_name

<Button>:
    font_name: app.font_name

<ToggleButton>:
    font_name: app.font_name

<TextInput>:
    font_name: app.font_name

<Spinner>:
    font_name: app.font_name

<SpinnerOption>:
    font_name: app.font_name

<PrimaryButton@Button>:
    background_normal: ""
    background_color: (0.43, 0.91, 1.0, 1.0)
    color: (0, 0, 0, 1)
    bold: True

<DangerButton@Button>:
    background_normal: ""
    background_color: (1.0, 0.39, 0.49, 1.0)
    color: (1, 1, 1, 1)
    bold: True

<ChipLabel@Label>:
    size_hint_y: None
    height: "24dp"
    color: (1, 1, 1, 0.75)

<AppRoot>:
    orientation: "vertical"

    BoxLayout:
        size_hint_y: None
        height: "52dp"
        padding: "12dp"
        spacing: "12dp"
        canvas.before:
            Color:
                rgba: (0.06, 0.08, 0.14, 1.0)
            Rectangle:
                pos: self.pos
                size: self.size

        Label:
            text: "运输明细（离线）"
            bold: True
            font_size: "18sp"
            halign: "left"
            valign: "middle"
            text_size: self.size

        Widget:

        PrimaryButton:
            text: "新建"
            size_hint_x: None
            width: "84dp"
            on_release: app.open_create_dialog()

    ScreenManager:
        id: sm

        HomeScreen:
            id: home
            name: "home"

        EditorScreen:
            id: editor
            name: "editor"


<HomeScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: "12dp"
        spacing: "10dp"

        BoxLayout:
            size_hint_y: None
            height: "34dp"
            spacing: "10dp"
            ToggleButton:
                id: tab_recent
                text: "最近打开"
                group: "tabs"
                state: "down"
                on_release: root.switch_tab("recent")
            ToggleButton:
                id: tab_all
                text: "所有表格"
                group: "tabs"
                on_release: root.switch_tab("all")
            Widget:
            Button:
                text: "刷新"
                size_hint_x: None
                width: "80dp"
                on_release: root.refresh()

        RecycleView:
            id: rv
            viewclass: "TableListRow"
            scroll_type: ["bars", "content"]
            bar_width: "6dp"
            RecycleBoxLayout:
                default_size: None, "56dp"
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: "vertical"


<TableListRow@BoxLayout>:
    table_id: ""
    name_text: ""
    sub_text: ""
    orientation: "horizontal"
    padding: "10dp"
    spacing: "10dp"
    size_hint_y: None
    height: "56dp"
    canvas.before:
        Color:
            rgba: (1, 1, 1, 0.06)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10,]

    BoxLayout:
        orientation: "vertical"
        Label:
            text: root.name_text
            bold: True
            halign: "left"
            valign: "middle"
            text_size: self.size
        ChipLabel:
            text: root.sub_text
            halign: "left"
            valign: "middle"
            text_size: self.size

    Widget:

    Button:
        text: "打开"
        size_hint_x: None
        width: "72dp"
        on_release: app.open_table(root.table_id)

    Button:
        text: "删除"
        size_hint_x: None
        width: "72dp"
        on_release: app.confirm_delete(root.table_id, root.name_text)


<EditorScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: "12dp"
        spacing: "10dp"

        BoxLayout:
            size_hint_y: None
            height: "42dp"
            spacing: "10dp"

            Button:
                text: "返回"
                size_hint_x: None
                width: "72dp"
                on_release: app.go_home()

            BoxLayout:
                orientation: "vertical"
                Label:
                    id: lbl_title
                    text: root.title_text
                    bold: True
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                ChipLabel:
                    id: lbl_meta
                    text: root.meta_text
                    halign: "left"
                    valign: "middle"
                    text_size: self.size

            Widget:

            ChipLabel:
                id: lbl_status
                text: root.status_text
                size_hint_x: None
                width: "140dp"
                halign: "right"
                valign: "middle"
                text_size: self.size

        BoxLayout:
            size_hint_y: None
            height: "42dp"
            spacing: "10dp"

            BoxLayout:
                orientation: "vertical"
                size_hint_x: None
                width: "170dp"
                ChipLabel:
                    text: "开始日期"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                TextInput:
                    id: inp_start_date
                    multiline: False
                    hint_text: "YYYY-MM-DD"
                    on_text_validate: app.set_start_date(self.text)

            Widget:

            Button:
                text: "+行"
                size_hint_x: None
                width: "72dp"
                on_release: app.add_row()

            Button:
                text: "-行"
                size_hint_x: None
                width: "72dp"
                on_release: app.remove_last_row()

        BoxLayout:
            size_hint_y: None
            height: "44dp"
            spacing: "10dp"

            PrimaryButton:
                text: "保存"
                on_release: app.save_current()
            PrimaryButton:
                text: "新表(保存并下一张)"
                on_release: app.save_and_next()
            Button:
                text: "汇总"
                on_release: app.summary()
            Button:
                text: "下载CSV"
                on_release: app.export_csv()
            DangerButton:
                text: "删除(不可恢复)"
                on_release: app.delete_current()

        BoxLayout:
            size_hint_y: None
            height: "30dp"
            Label:
                text: "表头固定 · 装车日期只读 · 金额自动算"
                color: (1, 1, 1, 0.6)
                halign: "left"
                valign: "middle"
                text_size: self.size

        BoxLayout:
            id: table_host
            orientation: "vertical"

